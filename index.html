<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>SuperChase Voice</title>
    <style>
        :root { --primary: #6366f1; --success: #10b981; --warning: #f59e0b; --danger: #ef4444; --dark: #1e293b; --darker: #0f172a; --gray: #94a3b8; --light: #e2e8f0; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: linear-gradient(135deg, var(--darker), var(--dark)); color: var(--light); min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        h1 { font-size: 1.5rem; margin-bottom: 10px; }
        #status { color: var(--gray); margin-bottom: 20px; font-size: 0.95rem; }
        #status.ready { color: var(--success); }
        #status.error { color: var(--danger); }
        #mic { width: 150px; height: 150px; border-radius: 50%; border: none; background: linear-gradient(135deg, var(--warning), #d97706); color: white; font-size: 4rem; cursor: pointer; box-shadow: 0 10px 40px rgba(245,158,11,0.4); }
        #mic.listening { background: linear-gradient(135deg, #f59e0b, #d97706); animation: pulse 1s infinite; }
        #mic.speaking { background: linear-gradient(135deg, var(--success), #059669); }
        #mic.thinking { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        #mic.ready { background: linear-gradient(135deg, var(--primary), #4f46e5); }
        @keyframes pulse { 0%,100%{box-shadow:0 10px 40px rgba(245,158,11,0.5)} 50%{box-shadow:0 10px 60px rgba(245,158,11,0.7)} }
        #out { margin-top: 25px; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 15px; max-width: 90%; width: 350px; min-height: 80px; text-align: center; }
        .btns { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 20px; }
        .btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 12px 20px; border-radius: 25px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>SuperChase Voice</h1>
    <div id="status">Tap to start</div>
    <button id="mic">ðŸŽ¤</button>
    <div id="out">Tap the microphone to enable voice</div>
    <div class="btns">
        <button class="btn" data-q="What tasks do I have?">Tasks</button>
        <button class="btn" data-q="Project status">Projects</button>
        <button class="btn" data-q="Any leads?">Leads</button>
        <button class="btn" data-q="Status report">Status</button>
    </div>
<script>
const K='sk_96f976dbf7db9272ce178cb180f4d83cd1def2f1dfbb71f2',V='JBFqnCBsd6RMkjVDRZzb';
let rec,aud,setup=false,listening=false,speaking=false;
const mic=document.getElementById('mic'),st=document.getElementById('status'),out=document.getElementById('out');

async function init(){
    st.textContent='Setting up...';
    out.textContent='Requesting microphone...';
    try{await navigator.mediaDevices.getUserMedia({audio:true})}catch(e){st.textContent='Mic blocked';st.className='error';out.textContent='Allow microphone in browser settings and refresh.';return false}
    const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
    if(!SR){st.textContent='Use Chrome/Safari';return false}
    rec=new SR();rec.lang='en-US';rec.continuous=false;rec.interimResults=true;
    rec.onstart=()=>{listening=true;mic.className='listening';st.textContent='Listening...'};
    rec.onresult=e=>{const r=e.results[e.results.length-1];if(r.isFinal)process(r[0].transcript);else out.textContent='ðŸŽ¤ "'+r[0].transcript+'..."'};
    rec.onerror=e=>{listening=false;mic.className='ready';if(e.error==='no-speech')st.textContent='No speech. Tap again.';else st.textContent='Error: '+e.error};
    rec.onend=()=>{if(listening&&!speaking){listening=false;mic.className='ready';st.textContent='Ready - tap to talk'}};
    setup=true;mic.className='ready';st.textContent='Ready - tap to talk';st.className='ready';out.textContent='Tap microphone and speak';return true
}

async function listen(){if(!setup&&!await init())return;if(speaking){aud?.pause();speaking=false}listening=true;out.textContent='ðŸŽ¤ Listening...';try{rec.start()}catch(e){rec.stop();setTimeout(()=>rec.start(),200)}}
function stop(){listening=false;try{rec.stop()}catch(e){}mic.className='ready'}

async function process(t){stop();out.textContent='You: "'+t+'"';mic.className='thinking';st.textContent='Thinking...';const r=respond(t);await new Promise(r=>setTimeout(r,300));out.textContent=r;speak(r)}

function respond(t){t=t.toLowerCase();if(t.includes('task')||t.includes('todo'))return"Your SC Tasks has items in To Do, In Progress, and Done.";if(t.includes('project'))return"SC Projects tracks your initiatives.";if(t.includes('lead')||t.includes('sales'))return"SC Leads has prospects across stages.";if(t.includes('status')||t.includes('report'))return"All 5 SuperChase projects syncing. What area to focus on?";if(t.includes('hello')||t.includes('hi')||t.includes('hey'))return"Hey Chase! What do you need?";return"I can help with tasks, projects, leads, contracts, or expenses."}

async function speak(t){speaking=true;mic.className='speaking';st.textContent='Speaking...';
try{const r=await fetch('https://api.elevenlabs.io/v1/text-to-speech/'+V,{method:'POST',headers:{'Accept':'audio/mpeg','Content-Type':'application/json','xi-api-key':K},body:JSON.stringify({text:t,model_id:'eleven_turbo_v2_5',voice_settings:{stability:0.5,similarity_boost:0.75}})});
if(!r.ok)throw new Error('TTS error');const b=await r.blob(),u=URL.createObjectURL(b);aud=new Audio(u);aud.onended=()=>{speaking=false;mic.className='ready';st.textContent='Ready - tap to talk';st.className='ready'};aud.play().catch(()=>fallback(t))}catch(e){fallback(t)}}

function fallback(t){if(!window.speechSynthesis){speaking=false;mic.className='ready';st.textContent='Ready';return}const u=new SpeechSynthesisUtterance(t);u.onend=u.onerror=()=>{speaking=false;mic.className='ready';st.textContent='Ready - tap to talk'};speechSynthesis.speak(u)}

mic.onclick=async()=>{if(speaking){aud?.pause();speaking=false;mic.className='ready';st.textContent='Ready'}else if(listening)stop();else await listen()};
document.querySelectorAll('.btn').forEach(b=>b.onclick=async()=>{if(!setup&&!await init())return;process(b.dataset.q)});
</script>
</body>
</html>
